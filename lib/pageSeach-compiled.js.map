{"version":3,"sources":["pageSeach.js"],"names":[],"mappings":"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","file":"pageSeach-compiled.js","sourcesContent":["/*\n * GET home page.\n */\nvar blog = require('./nedb/blog');\n\nvar config = require(\"./config.js\").config;\nvar tool = require('./tool');\nvar blogword=require('./nedb/blogword.js') ;\n\nexports.index = function (req, res) {\n    var listli = '';\n    var b = {};\n    b.title = config.title;\n    b.description = config.description;\n\n\n    var xuanzhong = config.menu;\n    var classname = '';\n\n    var cSize = req.query.pageSize;\n    var word=req.query.word ;\n    console.log(req.session,req.sessionID)\n\n    if (!cSize) {\n        cSize = 100;\n    }\n\n    var page = parseInt(req.params.page) || 1;\n\n    classname = classname + '<ul class=\"nav pull-right navbar-nav\">';\n    classname = classname + '<li class=\"active\" ><a href=\"/\">首页</a></li>';\n    for (var i = 0; i < xuanzhong.length; i++) {\n\n\n        classname = classname + '<li><a href=\"' + xuanzhong[i].url + '\">' + xuanzhong[i].name + '</a></li>';\n\n    }\n    classname = classname + '</ul>';\n\n\n    var myDate = new Date();\n    var time1 = tool.formatFullDate(myDate);\n\n    blog.newlist().then(function ( v) {\n\n            listli = listli + '<ul class=\"grove-list\">';\n            for (var i = 0; i < v.length; i++) {\n                // log.warn('11111','<a href=\"/blog/' + v[i]._id + '.html\">') ;\n                listli = listli + '<li><h5 class=\\\"media-heading\\\">';\n                listli = listli + '<a href=\"/blog/' + v[i]._id + '.html\">';\n                listli = listli + '' + v[i].title + '';\n                listli = listli + '</a>';\n                listli = listli + '</li>';\n                if (i == 10) {\n                    break;\n                }\n            }\n            listli = listli + '</ul\">';\n\n            if(word) {\n                 console.log(word) ;\n                return blog.seach(word)\n            }\n            else\n            {\n                return false ;\n             //  return res.render('search', {blog: b, listli: listli, classname: classname, paginate:''});\n            }\n\n        }\n    ).then(function (list) {\n            var toplist = [];\n            if (list&&list.length>0) {\n                for (var i = 0; i < list.length; i++) {\n                    var top = list[i];\n                    if (list[i].content) {\n                        top.content = tool.delHtmlTag(list[i].content);\n                    }\n                    toplist.push(top);\n                }\n                list.sort(tool.sortJSONArry('created', true, Date.parse));\n            }\n\n\n\n            var ret = {\n                page: page,\n                perPage: cSize,\n                total: list.length,\n                items: tool.getPageData(toplist, cSize, page),\n                pages: tool.getPageInfo(list.length, cSize).pageCount\n\n            }\n\n\n            //  res.send(ret);\n            if (ret) {\n                res.render('search', {blog: b, listli: listli, classname: classname, paginate: ret});\n            }\n            else {\n                res.render('search', {blog: b, listli: listli, classname: classname, paginate: ''});\n            }\n           var args={} ;\n            args.key=word ;\n            args.create=time1 ;\n\n            return blogword.seachkey(args)\n        }, function (err) {\n            console.log(err);\n        }\n    ).catch(function(err)\n    {\n        console.log(err) ;\n    }\n    )\n\n};\n\n"]}
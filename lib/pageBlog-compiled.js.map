{"version":3,"sources":["pageBlog.js"],"names":[],"mappings":"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","file":"pageBlog-compiled.js","sourcesContent":["var blog = require('./nedb/blog');\nvar tool = require('./tool');\nvar config = require('./config').config;\nexports.index = function (req, res) {\n    console.log('ht',req.session,req.sessionID);\n    var AjaxType = req.param('ajax');\n    console.log(AjaxType) ;\n    switch (AjaxType) {\n        case \"add\":\n            blogadd(req, res);\n            break;\n        case \"newsedit\":\n            newsedit(req, res);\n            break;\n        case \"blogDel\":\n            blogDel(req, res);\n            break;\n        case \"blogedit\":\n            blogedit(req, res);\n            break;\n        case \"bloginfo\":\n            bloginfo(req, res);\n            break;\n        case \"pagePageInfo\":\n            pagePageInfo(req, res);\n            break;\n        case \"edit\":\n            var id = req.query.id;\n            res.render(\"admin/blogedit\", {id: id});\n            break;\n        case \"list\":\n            res.render(\"admin/bloglist\");\n            break;\n        default :\n            res.render(\"admin/blogIndex\");\n            break;\n    }\n};\n\n\nfunction blogedit(req, res) {\n    var id = req.param('id');\n\n\n\n    var content = unescape(req.param('c'));\n    var t = unescape(req.param('t'));\n    var column=req.param('column') ;\n    var  texttime=req.param('texttime') ;\n\n    var myDate = new Date();\n    var time1 = tool.formatFullDate(myDate);\n\n    var classname = '';\n    classname = classname + '<ul class=\"nav pull-right navbar-nav\">';\n    classname = classname + '<li><a href=\"/\">首页</a></li>';\n    var xuanzhong = config.menu;\n    for (var i = 0; i < xuanzhong.length; i++) {\n        if (xuanzhong[i].m == column) {\n            classname = classname + '<li class=\"active\"><a href=\"' + xuanzhong[i].url + '\">' + xuanzhong[i].name + '</a></li>';\n        }\n        else {\n            classname = classname + '<li><a href=\"' + xuanzhong[i].url + '\">' + xuanzhong[i].name + '</a></li>';\n        }\n    }\n    classname = classname + '</ul>';\n\n\n    return blog.info(id).then(function (data) {\n        var info = data;\n        info.title = t;\n        info.column = column;\n        info.content = content;\n        info.updated = time1;\n        info.created = texttime;\n        info.update_username = tool.cookuserinfo(req).username;\n\n        info.uuid = info._id;\n        console.log(info);\n        return blog.blogedit(info).then(function (data) {\n            info.classname = classname;\n                tool.write_html('blogindex.html', info, \"/blog/\" + info._id + \".html\", function (e, v) {\n                            console.log('生成新闻', e, v);\n                        res.send('修改成功');\n                        }\n                    )\n\n            }, function (err) {\n                return res.send(err);\n            }\n        )\n        }\n    )\n\n}\nfunction bloginfo(req, res) {\n    var id = req.query.id;\n    return blog.info(id).then(function (data) {\n        return res.send(data);\n        }\n    );\n}\nfunction blogDel(req, res) {\n    var id = req.query.id;\n    var args = {};\n    args.uuid = id;\n    return blog.blogDel(args).then(function (data) {\n            res.send('1');\n        }, function (err) {\n            console.error(err)\n            res.send(err);\n        }\n    )\n}\nfunction pagePageInfo(req, res) {\n    var cSize = req.query.pageSize;\n    var cPage = req.query.currentPage;\n\n    return blog.list().then(function (data) {\n            //console.log(data);\n            data.sort(tool.sortJSONArry('created', true, Date.parse));\n\n        var ret = {\n            pageInfo: tool.getPageInfo(data.length, cSize),\n            pageData: tool.getPageData(data, cSize, cPage)\n        }\n\n            res.send(ret);\n        }, function (err) {\n            res.send(err);\n        }\n    )\n}\n\n//博客添加\nfunction blogadd(req, res) {\n    var title = (unescape(req.param('t')));\n    var content = (unescape(req.param('c')));\n    //var myDate=req.query.texttime;\n\n    var  myDate=req.param('texttime') ;\n    if(!myDate)\n    {\n        myDate=new Date() ;\n    }\n    var time = tool.formatFullDate(myDate);\n    var column=req.param('column') ;\n\n    var info = {\n        _id: tool.generateUUID(32),\n        title: title,\n        content: content,\n        column:column,\n        yuedu: 0,\n        created: time,\n        create_username: tool.cookuserinfo(req).username\n    };\n\n    var classname = '';\n    classname = classname + '<ul class=\"nav pull-right navbar-nav\">';\n    classname = classname + '<li><a href=\"/\">首页</a></li>';\n    var xuanzhong = config.menu;\n    for (var i = 0; i < xuanzhong.length; i++) {\n        if (xuanzhong[i].m == info.column) {\n            classname = classname + '<li class=\"active\"><a href=\"' + xuanzhong[i].url + '\">' + xuanzhong[i].name + '</a></li>';\n        }\n        else {\n            classname = classname + '<li><a href=\"' + xuanzhong[i].url + '\">' + xuanzhong[i].name + '</a></li>';\n        }\n    }\n    classname = classname + '</ul>';\n\n   // info.classname = classname;\n\n    return blog.add(info).then(function (data) {\n            info.classname = classname;\n            tool.write_html('blogindex.html', info, \"/blog/\" + info._id + \".html\", function (e, v) {\n                   // console.log('生成新闻', e, v);\n                    res.send('1') ;\n                }\n            )\n\n        }, function (err) {\n            res.send('0');\n        }\n    )\n}"]}